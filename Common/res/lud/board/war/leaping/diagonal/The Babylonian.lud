(define "OrthogonalHopCaptureCounter"
    (do
        (move Hop 
            #1
            Orthogonal
            (between 
                before:2
                after:2
                if:(and (= 2 (count Steps (from) (between))) ("IsEnemyAt" (between)))
                (apply (remove (between)))
            ) 
            (to if:(is Empty (to))) 
        )
        ifAfterwards:(is In (last To) (sites Phase 1))
        #2
    )
)

(define "MoveAgainIfCanCaptureAgain" 
    (then 
        ("ReplayIfCanMove" 
            (or 
                ("HopCapture" (from (last To)) Diagonal)
                ("OrthogonalHopCaptureCounter" (from (last To)))
            )
        )
    )
)

(define "CounterMove"
    (or {
        ("StepToEmpty" Diagonal) 
        (move Slide Orthogonal (between (exact 2))) 
        ("HopCapture" (from) Diagonal ("MoveAgainIfCanCaptureAgain"))
        ("OrthogonalHopCaptureCounter" (from) ("MoveAgainIfCanCaptureAgain"))
    })
)

//------------------------------------------------------------------------------

(game "The Babylonian" 
    (players 2) 
    (equipment { 
        (board (square 10)) 
        (piece "Counter" Each "CounterMove")
        (regions P1 (sites Bottom))
        (regions P2 (sites Top))
    }) 
    (rules 
        ("WhiteCellsSetup" 4)
        
        (play 
            (if ("SameTurn")
                (or {
                    ("HopCapture" (from (last To)) Diagonal ("MoveAgainIfCanCaptureAgain"))
                    ("OrthogonalHopCaptureCounter" (from (last To)) ("MoveAgainIfCanCaptureAgain"))
                    (move Pass)
                })
                (forEach Piece)
            )
        ) 
        
        (end ("CaptureAll" Next)) 
    )
)

//------------------------------------------------------------------------------

(metadata 
    
    (info
        {
        (description "The Babylonian was a game that became popular in Paris around 1736, and continued to be played in the Netherlands into the nineteenth century. It was played on a Polish Draughts Board, but the pieces move as Chess queens.")
        (rules "10x10 checkered board. Twenty pieces per player, arranged on the four rows closest to the player. Pieces move orthogonally or diagonally in any direction, only on the white spaces. Pieces may capture by jumping over an enemy piece to an empty space on the other side of it. Multiple captures in one turn are allowed. The player to capture all of the opponent's pieces wins.")
        (source "Twiss 1805: 172; Murray 1951: 81.")
        (id "884")
        (version "1.3.14")
        (classification "board/war/leaping/diagonal")
        (credit "Eric Piette")
        (origin "This game was played in France, from around 1736 to 1805.")
        }
    )
    
    (graphics {
        (board Style Chess)
        (piece Families {"Defined" "Isometric"})
    })
    
    (ai
        "The Babylonian_ai"
    )
)
