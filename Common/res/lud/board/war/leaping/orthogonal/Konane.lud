(define "Hop"
    (move
        Hop
        (from #1)
        #2
        (between
            if:(is Enemy (who at:(between)))
            (apply (remove (between)))
        )
        (to if:(is Empty (to)))
        #3
    )
)

(define "HopSequence" ("Hop" #1 #2 (then (if (can Move ("Hop" (last To) SameDirection)) (moveAgain)))))

//------------------------------------------------------------------------------

(game "Konane"
    (players 2)
    (equipment {
        <Board>
        (piece "Marker" Each)
    })
    (rules
        (start {
            (place "Marker1" (sites Phase 1) )
            (place "Marker2" (sites Phase 0) )
        })

        phases:{
        (phase "OpeningP1" P1
            (play
                (move
                    Remove
                    (intersection
                        (union
                            (sites Corners)
                            (sites Centre)
                        )
                        (sites Phase 1)
                    )
                )
            )
            (nextPhase Mover "Movement")
        )
        (phase "OpeningP2" P2
            (play
                (move
                    Remove
                    (sites Around (last To) Own)
                )
            )
            (nextPhase Mover "Movement")
        )
        (phase "Movement" (play
                (if "SameTurn"
                    (or
                        ("HopSequence" (last To) SameDirection)
                        (move Pass)
                    )
                    (forEach Piece "Marker" ("HopSequence" (from) Orthogonal) )
                )
            )
        )
        }

        (end ("NoMoves" Loss))
    )
)

//------------------------------------------------------------------------------

(option "Board Size" <Board> args:{ <size> }
    {
    (item "6x6"   <(board (square 6))>         "The game is played on a 6x6 board.")
    (item "8x8"   <(board (square 8))>         "The game is played on a 8x8 board.")
    (item "10x10" <(board (square 10))>        "The game is played on a 10x10 board.")*
    (item "12x12" <(board (square 12))>        "The game is played on a 12x12 board.")
    (item "14x14" <(board (square 14))>        "The game is played on a 14x14 board.")
    (item "16x16" <(board (square 16))>        "The game is played on a 16x16 board.")
})

//------------------------------------------------------------------------------

(rulesets {

    (ruleset "Ruleset/15x15 Konane (Incomplete)" {

    })

    (ruleset "Ruleset/14x17 Konane (Incomplete)" {

    })

    (ruleset "Ruleset/13x20 Konane (Incomplete)" {

    })

    (ruleset "Ruleset/13x15 Konane (Incomplete)" {

    })

    (ruleset "Ruleset/13x13 Konane (Incomplete)" {

    })

    (ruleset "Ruleset/12x15 Konane (Incomplete)" {

    })

    (ruleset "Ruleset/11x13 Konane (Incomplete)" {

    })

    (ruleset "Ruleset/11x11 Konane (Incomplete)" {

    })

    (ruleset "Ruleset/9x13 Konane (Incomplete)" {

    })

    (ruleset "Ruleset/9x10 Konane (Incomplete)" {

    })

    (ruleset "Ruleset/9x9 Konane (Incomplete)" {

    })

    (ruleset "Ruleset/8x13 Konane (Incomplete)" {

    })

    (ruleset "Ruleset/8x11 Konane (Incomplete)" {

    })

    (ruleset "Ruleset/8x8 Konane (Suggested)" {
        "Board Size/8x8"
    })

    (ruleset "Ruleset/10x10 Konane (Observed)" {
        "Board Size/10x10"
    })*

    (ruleset "Ruleset/15x15 Konane (Reconstructed)" {

    })

    (ruleset "Ruleset/14x17 Konane (Reconstructed)" {

    })

    (ruleset "Ruleset/13x20 Konane (Reconstructed)" {

    })

    (ruleset "Ruleset/13x15 Konane (Reconstructed)" {

    })

    (ruleset "Ruleset/13x13 Konane (Reconstructed)" {

    })

    (ruleset "Ruleset/12x15 Konane (Reconstructed)" {

    })

    (ruleset "Ruleset/11x13 Konane (Reconstructed)" {

    })

    (ruleset "Ruleset/11x11 Konane (Reconstructed)" {

    })

    (ruleset "Ruleset/9x13 Konane (Reconstructed)" {

    })

    (ruleset "Ruleset/9x10 Konane (Reconstructed)" {

    })

    (ruleset "Ruleset/9x9 Konane (Reconstructed)" {

    })

    (ruleset "Ruleset/8x13 Konane (Reconstructed)" {

    })

    (ruleset "Ruleset/8x11 Konane (Reconstructed)" {

    })

})

//------------------------------------------------------------------------------

(metadata

    (info
        {
        (description "Konane is an indigenous Hawaiian game played on a board that varies: it can range from 6x6 to more than 14x14, and does not have to be square. It is a game with leaping capture, and has been played at least since the eighteenth century, but probably for longer. Konane boards can be found on rock surfaces throughout Hawaii, but they are difficult to date.")
        (useFor "Ruleset/10x10 Konane (Observed)" (rules "10x10 board. The black player starts by removing one black piece either from one of the central four spaces of the board or from one of the four corners. The white player then must remove a white piece that is orthogonally adjacent to the empty space. Play proceeds by orthogonally jumping an opposing piece and capturing it. All moves must be capturing moves. Multiple captures can be made only by continuing in the same direction. The first player unable to move loses."))
        (useFor "Ruleset/10x10 Konane (Observed)" (source "Emory 1924: 85."))
        (useFor "Ruleset/8x8 Konane (Suggested)" (rules "8x8 board. The black player starts by removing one black piece either from one of the central four spaces of the board or from one of the four corners. The white player then must remove a white piece that is orthogonally adjacent to the empty space. Play proceeds by orthogonally jumping an opposing piece and capturing it. All moves must be capturing moves. Multiple captures can be made only by continuing in the same direction. The first player unable to move loses.
        "))
        (useFor "Ruleset/8x11 Konane (Incomplete)" (rules "8x11 board."))
        (useFor "Ruleset/8x13 Konane (Incomplete)" (rules "8x13 board."))
        (useFor "Ruleset/9x9 Konane (Incomplete)" (rules "9x9 board."))
        (useFor "Ruleset/9x10 Konane (Incomplete)" (rules "9x10 board."))
        (useFor "Ruleset/9x13 Konane (Incomplete)" (rules "9x13 board."))
        (useFor "Ruleset/11x11 Konane (Incomplete)" (rules "11x11 board."))
        (useFor "Ruleset/11x13 Konane (Incomplete)" (rules "11x13 board."))
        (useFor "Ruleset/12x15 Konane (Incomplete)" (rules "12x15 board."))
        (useFor "Ruleset/13x13 Konane (Incomplete)" (rules "13x13 board.
        "))
        (useFor "Ruleset/13x15 Konane (Incomplete)" (rules "13x15 board."))
        (useFor "Ruleset/13x20 Konane (Incomplete)" (rules "13x20 board."))
        (useFor "Ruleset/14x17 Konane (Incomplete)" (rules "14x17 board.
        "))
        (useFor "Ruleset/15x15 Konane (Incomplete)" (rules "15x15 board."))
        (source "Murray 1951: 97")
        (version "1.3.0")
        (classification "board/war/leaping/orthogonal")
        (credit "Eric Piette")
        (origin  "This game was played in Hawaii, from around 1779 to 1924.")
        }
    )

    (graphics {
        (player Colour P1 (colour Black))
        (player Colour P2 (colour White))
        (board Colour Phase0 (colour 223 178 110))
        (board Colour InnerEdges (colour Black))
        (board Colour OuterEdges (colour Black))
    })

    (ai
        "Konane_ai"
    )

)
